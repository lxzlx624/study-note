### TCP的建立（三次握手）

1、客户端=》服务端

​	SYN=1，ACK=0，seq=x;

​	此时客户端进入SYN-SEND状态；

2、服务端=》客户端

​	SYN=1，ACK=1，seq=y，ack=x+1;

​	此时服务端进入SYN-RECEVIED状态；

3、客户端=》服务端

​	ACK=1，ack=y+1，seq=x+1；

​	此时可以发送数据。客户端服务端进入establish状态

Q：为什么要3次握手，最后一次握手可以取消吗？

A：不行，为了避免无效的连接请求。如果握手变成两次，客户端第一次发送请求的数据包，因为延迟触发重传的话，第二次发送的数据包已经建立了连接，完成数据的发送和连接的释放。第一次发送的请求建立连接的数据包达到，由于只有两次握手，服务端接受到包之后进入establish状态，等待客户端发送数据，而客户端则是变成了close状态。所以需要进行三次握手。



#### TCP的释放（四次挥手）

客户端和服务端均可发起对连接的释放请求。

1、客户端=》服务端

​	FIN=1，ACK=1，seq=x，ack=y

2、服务端=》客户端

​	FIN=1，ACK=1，seq=y，ack=x+1

​	此时，客户端=》服务端的连接单向关闭。但是服务端仍可发数据给客户端。



3、服务端=》客户端

​	FIN=1，ACK=1，seq=n，ack=x+1

4、客户端=》服务端

​	FIN=1，ACK=1，seq=x+1，ack=n+1

因为TCP是全双工通信，所以需要四次挥手释放tcp的连接